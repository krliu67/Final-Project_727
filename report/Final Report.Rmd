---
title: "A Content Analysis of Reddit User's Response Towards Students for Fair Admissions v. Harvard"
subtitle: "Term paper for SURV/SURVMETH 727"
author: "Chloe Chen & Kangrui Liu"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    df_print: kable
bibliography: references.bib
csl: american-sociological-association.csl
header-includes:
   - \usepackage{dcolumn} 

---

```{r setup, include=FALSE, tidy=TRUE}
knitr::opts_chunk$set(echo=TRUE,cache=TRUE, 
                      autodep=TRUE, cache.comments=FALSE,
                      message=FALSE, warning=FALSE)
```

```{r, message = FALSE, warning = FALSE, include=FALSE}
# load packages
library(xml2)
library(rvest)
library(tidyverse)
library(jsonlite)
library(robotstxt)
library(RSocrata)
library(dplyr)
library(tidytext)
library(tm)
library(RedditExtractoR)
library(stringr)
library(magrittr)
library(ggpubr)
library(zoo)
library(xts)
library(quanteda)
library(SentimentAnalysis)
library(vader)
library(GGally)
library(magrittr)
library(dplyr)
library(knitr)
library(wordcloud)
library(tidytext)
library(tm)
library(RColorBrewer)
library(dplyr)
library(png)
```

```{r, include = FALSE}
posts <- read.csv("../data/selected_posts.csv", 
                     header = TRUE, 
                     # sep = ";", 
                     encoding = "UTF-8") %>% distinct()
```


```{r, include = FALSE}
# load comments

comments <- read.csv("../data/scraped_comments_by_selected_posts.csv", 
                     header = TRUE, 
                     # sep = ";", 
                     encoding = "UTF-8") %>% distinct()

text_comments <- comments %>% dplyr::select(date,comment,url)

irrelevantWords <- c("[deleted]","[removed]")

filtered_comments <- text_comments %>% filter(comment != "[deleted]" & comment != "[removed]")
```

```{r, include = FALSE}
# load sm
sentiments <- read.csv("../data/sentiments.csv", 
                     header = TRUE, 
                     # sep = ";", 
                     encoding = "UTF-8")
```

```{r, include = FALSE}
all_comments <- read.csv("../data/comments/all_comments.csv", 
                     header = TRUE, 
                     # sep = ";", 
                     encoding = "UTF-8")

all_comments$date <- as.Date(all_comments$date)

irrelevantWords <- c("[deleted]","[removed]")

filtered_all_comments <- all_comments %>% filter(comment != "[deleted]" & comment != "[removed]")
```

# Abstract

This study investigates public sentiment and discourse on Reddit regarding the landmark Supreme Court decision in Students for Fair Admissions v. Harvard, which ruled race-based affirmative action in college admissions unconstitutional. Our research aims to understand the impact of this decision on public opinion, particularly among Reddit users. The study focuses on three key questions: 1) Did the Supreme Court's decision incite increased discussion about race-based affirmative action among Reddit users? 2) How did public sentiment change over this period, particularly before and after the Supreme Court's decision? 3) What specific topics dominated these discussions? To answer these questions, we collected data from Reddit comments, employed the Latent Dirichlet Allocation (LDA) model for content filtering and sentiment analysis, supplemented by time series analysis to track sentiment changes. We also analyzed word frequencies to understand the focus of discussions. Our findings indicate a noticeable increase in discussions about affirmative action on Reddit following the Supreme Court decision. The overall sentiment trended negatively over time, suggesting growing public disapproval of affirmative action policies on the platform. Word frequency calculations reveal "Asian" as a predominant focus in the debate, with differing emotional tones in discussions about different racial groups.

## Introduction

Students for Fair Admissions v. Harvard is a landmark decision of the Supreme Court of the United States, in which the court determined that race-based affirmative action in college admissions violates the Fourteenth Amendment's Equal Protection Clause on 29th June, 2023 (Totenberg, 2023). This ruling barred all public and private colleges from considering race in admissions decisions, significantly changing the landscape of affirmative action in higher education, reflecting the deep divide and ongoing controversy over these policies. The case began in 2013 when Students for Fair Admissions (SFFA) filed a lawsuit against Harvard University. SFFA claimed that Harvard's admissions practices violated Title VI of the Civil Rights Act of 1964 by discriminating against Asian Americans​. In 2017, under the Trump administration, the Department of Justice opened an investigation into the allegations against Harvard's policies​. The case reached the Supreme Court, and on June 29, 2023, the Supreme Court issued a decision by a vote of 6-2 that reversed the lower court's ruling and held that affirmative action in college admissions is unconstitutional​ (Chamberlain, 2023; Deliso, 2023). 

The debated focus in this case is “affirmative action”, which has long been a controversial and often poorly understood policy (Crosby et al., 2006). Affirmative action refers to policies that support members of disadvantaged groups that have previously suffered discrimination in areas such as education and employment. In the United States, affirmative action typically involves measures to improve the opportunities for historically excluded groups, particularly racial minorities, which can include setting goals for inclusion, outreach efforts, and in some cases, considering race or gender as one factor in university admissions or hiring processes (Rubenfeld, 1997). The concept is controversial for several reasons. Firstly, critics argue that it can undermine the principles of meritocracy and fairness, as it may give less qualified candidates an advantage over more qualified candidates due to their race or gender. It can also lead to reverse discrimination, where members of a majority group feel they are being unfairly discriminated against in favor of minority groups. Besides, there is a concern that affirmative action can stigmatize beneficiaries, making it seem that they cannot succeed without special treatment, which can be detrimental to their self-esteem and societal views of their capabilities (Skrentny, 2018). Further, the debate often centers around whether the focus should be on equality of opportunity (not discriminating and allowing everyone an equal chance) or equality of outcome (actively working to ensure that groups that have been historically disadvantaged are represented proportionally) (Fryer & Loury, 2005).

Therefore, studying public opinion towards Students for Fair Admissions v. Harvard, particularly the Supreme Court's decision, is of paramount importance. It offers a comprehensive perspective on the attitudes of various stakeholders towards the policy. This analysis can hopefully reflect the role that the policy plays in contemporary American society, and yield insights for policy implications.

Specifically, we aim to answer: (1) Did the Supreme Court's decision trigger increased discussions among Reddit users about race-based affirmative action in college admissions? (2) How did people's sentimental tendencies change during that period (especially, would this trend shift before and after the announcement of the Supreme Court's decision)? (3) What topics are of interest to these discussions? This research hopes to get insight into the above questions through the lens of social media with the aid of sentiment analysis. In the following section, we will specify the data sources and data gathering process.


## Methodology

### Data source

We collected Reddit comments posted before and after the Supreme Court decision leak (5/15/2015-11/30/2023), focusing on those containing keywords relevant to this topic, such as “affirmative action” “fair admission” “SFFA” and “admission discrimination”. Our search will be specifically targeted at certain subreddits. This approach is due to the difficulty in accurately identifying our intended content through a broad, site-wide search. To address potential representative biases that might arise from limiting our search to specific subreddits, we have intentionally chosen a diverse range of subreddits, including those named after various races and representing both major political parties, ensuring considerable heterogeneity in our data.


### Analysis techniques

To access the public opinion, we resorted to Reddit, which is one of the most popular websites in the United States over the years. At the time of writing, Reddit is the 3rd most popular website nationally. The prevalence of Reddit suggests a wealth of data and the potential for capturing a broad range of views. Additionally, the platform's anonymity encourages users to share their true thoughts without concern for social approval. Furthermore, Reddit is more conducive to research than other well-known social networks such as Facebook and Twitter, due to its provision of readily accessible data at no cost.

We collected relevant data using RedditExtractoR API on R. Briefly, we use keywords “affirmative action” “fair admission” “SFFA” and “admission discrimination”. Our search is specifically targeted at certain subreddits as listed in the graph that follows. This approach is due to the difficulty in accurately identifying our intended content through a broad, site-wide search. To address potential representative biases that might arise from limiting our search to specific subreddits, we intentionally chose a diverse range of subreddits, including those named after various races and representing both major political parties, ensuring considerable heterogeneity in our data. 


We employ the Latent Dirichlet Allocation (LDA) model to filter posts unrelated to our investigation after initial data scraping. After this, we conducted sentiment analysis coupled with time series analysis to investigate changes in sentiment over time. We also organized the most commonly used words with wordcloud to depict word frequencies associated with different sentiments. Finally, we include a total of 14785 comments in our analysis. Our working flow is shown in the following graph.

```{r, echo = FALSE, fig.cap="flowchart",out.width='400px',fig.align='center'}
knitr::include_graphics("flowchart.png")
```



### Results

The Mann-Kendall trend test indicates a downward trend in the overall sentiment. This suggests that, over the entire period from 2015 to 2023, public sentiment on Reddit regarding affirmative action became more negative.

### Conclusion and Discussion

In conclusion, \
1. The decision of the Supreme Court might be the trigger of public engagement on Reddit about this topic.\
2. Regarding the trend of attitude over time, we observed volatility in public sentiment on Reddit towards affirmative action during this period. This volatility might reflect the public's reaction to various events related to affirmative action during this period. This phenomenon also corresponds with existing studies, which revealed perceptions of affirmative action fluctuate substantially and in an irregular manner over time (Ewoh & Elliott 1997; Schuman et al. 1997). The variability in support for affirmative action may be anticipated, considering the ambiguity and breadth of the concept, as well as the prevalent misunderstandings regarding its definition (Crosby & Cordova 1996). \
3. But the downward trend in the overall sentiment is also noteworthy, suggesting public sentiment on Reddit regarding affirmative action became more negative.\
4. The calculation of word frequency indicates the debate overall is focused on “Asian”. There are nuanced differences between negative comments and positive posts, as “black” is a considerable component of comments with negative emotions.\

There are many limitations of the current study. As mentioned above, we do not know how representative the subreddit sample was of the whole U.S. population. Therefore, we could not blindly generalize the findings to the whole United States. Also, the LDA model hasn't been trained to the utmost, so the current posts may still include some noises.


### Plots
```{r, echo=FALSE, fig.cap="Number of Comments", fig.width=20, fig.align='center'}
# q1 plot
start_date <- as.Date("2015-05-15")
end_date <- as.Date("2023-06-29")

before <-  filtered_all_comments[filtered_all_comments$date >= start_date & filtered_all_comments$date < end_date, ]
after <- filtered_all_comments[filtered_all_comments$date >= end_date, ]

before_count <- before %>% dplyr::group_by(date) %>%  dplyr::summarise(num = dplyr::n())
after_count <- after %>% dplyr::group_by(date) %>%  dplyr::summarise(num = dplyr::n())

y_limits <- range(c(after_count$num, before_count$num))

p1 <- ggplot(data = after_count, mapping = aes(x = date, y = num, group = 1)) +
  geom_line() +
  ylim(y_limits) +
  scale_x_date(date_breaks = "1 month", date_labels = "%Y-%m") + 
  xlab('Date after Decision') +
  ylab('Number of Comments')

p2 <- ggplot(data = before_count, mapping = aes(x = date, y = num, group = 1)) +
  geom_line() +
  ylim(y_limits) +
  scale_x_date(date_breaks = "2 years", date_labels = "%Y-%m") + 
  xlab('Date before Decision') +
  ylab('Number of Comments')

ggarrange(p2,p1,ncol=2,nrow=1)
```

```{r, echo=FALSE, fig.cap="Rolling Mean of Time Series", fig.width=20, fig.align='center'}
# q2 plot
vaders_date <- filtered_comments %>% dplyr::select(date,url)

vaders_date <- cbind(vaders_date,sentiments$Vader)

colnames(vaders_date) <- c("date","url","vader")

start_date <- as.Date("2015-05-15")
end_date <- as.Date("2023-06-29")

vaders_date <- vaders_date[vaders_date$date >= start_date, ]

vaders_by_date <- vaders_date %>%  dplyr::group_by(date) %>% dplyr::summarise(mean_vader = mean(vader)) %>% data.frame()
vaders_by_date$date <- as.Date(vaders_by_date$date)

start_date <- as.Date("2015-05-15")
end_date <- as.Date("2023-06-29")

vaders_by_date_before <- vaders_by_date[vaders_by_date$date >= start_date & vaders_by_date$date < end_date, ]

vaders_by_date_after <- vaders_by_date[vaders_by_date$date >= end_date, ]

ts_vaders_by_date_before <- xts(vaders_by_date_before$m, order.by = vaders_by_date_before$date)

rolling_mean_vaders_by_date_before <- rollapply(ts_vaders_by_date_before, width = 5, FUN = mean, by = 5, align = 'right', na.rm = TRUE) %>% na.omit()

df_vaders_by_date_before <- data.frame(date = zoo::index(rolling_mean_vaders_by_date_before), mean_value = coredata(rolling_mean_vaders_by_date_before))

df_vaders_by_date_before <- df_vaders_by_date_before %>% na.omit()


ts_vaders_by_date_after <- xts(vaders_by_date_after$m, order.by = vaders_by_date_after$date)

rolling_mean_vaders_by_date_after <- rollapply(ts_vaders_by_date_after, width = 3, FUN = mean, by = 3, align = 'right', na.rm = TRUE) %>% na.omit()

df_vaders_by_date_after <- data.frame(date = zoo::index(rolling_mean_vaders_by_date_after), mean_value = coredata(rolling_mean_vaders_by_date_after))

df_vaders_by_date_after <- df_vaders_by_date_after %>% na.omit()

y_limits <- range(c(df_vaders_by_date_after$mean_value, df_vaders_by_date_before$mean_value))

p3 <- ggplot(df_vaders_by_date_before, aes(x = date, y = mean_value)) +
  geom_line() +
  ylim(y_limits) +
  theme_minimal() +
  labs(title = "5-Day Rolling Mean of Time Series", x = "Date before Decision", y = "Mean Sentiment Scores")

p4 <- ggplot(df_vaders_by_date_after, aes(x = date, y = mean_value)) +
  geom_line() +
  ylim(y_limits) +
  theme_minimal() +
  labs(title = "3-Day Rolling Mean of Time Series", x = "Date after Decision", y = "Mean Sentiment Scores")

ggarrange(p3,p4,ncol=2,nrow=1)
```

<!-- q3 wordcloud -->
```{r, echo=FALSE, fig.cap="WordCloud for all comments", out.width='200px', fig.align='center'}
knitr::include_graphics("wordcloud1.png")
```

```{r, echo=FALSE, fig.cap="WordCloud for positive comments", out.width='200px', fig.align='center'}
knitr::include_graphics("wordcloud1.png")
```

```{r, echo=FALSE, fig.cap="WordCloud for negative comments", out.width='200px', fig.align='center'}
knitr::include_graphics("wordcloud1.png")
```


```{r, echo=FALSE, fig.cap="Box Plot of mean vader from different subreddits", fig.width=10}
for (i in 1:dim(filtered_comments)[1]) {
  temp_url <- filtered_comments$url[i]
  temp_matches <- sub(".*/r/(.*)/comments/.*", "\\1", temp_url)
  filtered_comments$subreddit[i] <- temp_matches
}
rm(temp_matches)
rm(temp_url)

vaders_subreddit <- filtered_comments %>% dplyr::select(subreddit)

vaders_subreddit <- cbind(vaders_subreddit, sentiments$Vader)

colnames(vaders_subreddit) <- c("subreddit","vader")

ggplot(vaders_subreddit, aes(x = subreddit, y = vader)) +
  geom_boxplot() +
  labs(title = "Box Plot", x = "subreddit", y = "vader") +
  theme_minimal()
```


### Table
```{r, echo=FALSE}
kable(head(vaders_by_date), caption = "Mean Vader score by day", row.names = FALSE)
```


```{r, echo=FALSE}
# allTopicNames
df_LDA_topics <- read.csv("allTopicNames.csv", header = TRUE, encoding = "UTF-8")
colnames(df_LDA_topics) <- c("topic_number","topic_words")
# kable(df_LDA_topics, caption = "allTopicNames")
# choose 2,3,4,5,6,8,12,13,14,16,19,20,22,23,24
df_LDA_topics_filtered <- df_LDA_topics[c(2,3,4,5,6,8,12,13,14,16,19,20,22,23,24),]
kable(df_LDA_topics_filtered, caption = "filtered TopicNames",row.names = FALSE)
```

```{r, echo=FALSE}
# MK-test table
df_MK<- data.frame(
  vader_tau <- c(-0.0623,-0.0381,-0.1170),
  vader_p <- c(0.0490,0.2861,0.3550),
  afinn_tau <- c(0.0747,-0.0784,0.0091),
  afinn_p <- c(0.0969,0.0135,0.8942)
)
colnames(df_MK) <- c("vader_tau","vader_p","afinn_tau","afinn_p")
row.names(df_MK) <- c("data_overall","data_before","data_after")
kable(df_MK, caption = "MK-test table",row.names = TRUE)
```

## References

\linespread{1}


::: {#refs}

:::